# StoneFlowers ‚Äî –ó–∞–ø—É—Å–∫, –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ Docker ü™¥

–ö—Ä–∞—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç üöÄ

1. –í –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è `StoneFlowers.sln`) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ dotnet tools (–µ—Å–ª–∏ –µ—Å—Ç—å)
dotnet tool restore

# –°–æ–±—Ä–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ
dotnet build
```

2. –ü–æ–¥–Ω—è—Ç—å —Å–µ—Ä–≤–∏—Å—ã (API + PostgreSQL):

```bash
docker compose -f StoneFlowersApi/docker-compose.yml up --build -d
```

- API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ http://localhost:8080
- –î–ª—è –ª–æ–≥–æ–≤: `docker compose -f StoneFlowersApi/docker-compose.yml logs -f webapi`

## –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ EF Core (–ª–æ–∫–∞–ª—å–Ω–æ)

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–∞–±—Ä–∏–∫—É –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ `DataAccessLayer/DesignTime/StoneFlowersDbContextFactory.cs`, –ø–æ—ç—Ç–æ–º—É –º–∏–≥—Ä–∞—Ü–∏–∏ –º–æ–∂–Ω–æ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è domain-–º–æ–¥–µ–ª–µ–π.

–ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ (–∏–∑ –∫–æ—Ä–Ω—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è):

```bash
# –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –≤ –ø—Ä–æ–µ–∫—Ç–µ DataAccessLayer (–ø—Ä–∏–º–µ—Ä –Ω–∞–∑–≤–∞–Ω–∏—è: InitialCreate)
dotnet ef migrations add InitialCreate --project DataAccessLayer --startup-project StoneFlowersApi --output-dir Migrations --context StoneFlowersDbContext

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ª–æ–∫–∞–ª—å–Ω–æ)
dotnet ef database update --project DataAccessLayer --startup-project StoneFlowersApi --context StoneFlowersDbContext
```

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ connection string –≤ `StoneFlowersApi/appsettings.json` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `ConnectionStrings__StoneFlowerConnection` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ —Ä–∞–±–æ—Ç–∞—é—â—É—é –ë–î.
- `ServiceCollection` –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ—Ç `MigrationsAssembly("DataAccessLayer")`, –ø–æ—ç—Ç–æ–º—É –º–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `DataAccessLayer/Migrations`.

## Docker –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö)

–í `Program.cs` –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –∏ –≤—ã–∑–æ–≤ `DbInitializer.InitializeAsync(...)` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

–ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ë–î –ø—Ä–∏ –æ—Ç–ª–∞–¥–∫–µ:

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker compose -f StoneFlowersApi/docker-compose.yml down

# –£–¥–∞–ª–∏—Ç—å volume (–≤–Ω–∏–º–∞–Ω–∏–µ ‚Äî —ç—Ç–æ —É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ)
docker volume rm stoneflowersapi_postgres-data

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ
docker compose -f StoneFlowersApi/docker-compose.yml up --build -d
```

## –ì–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Å–∏–¥—ã/–º–∏–≥—Ä–∞—Ü–∏–∏ –∏ —á—Ç–æ –æ–Ω–∏ –¥–µ–ª–∞—é—Ç

- –ú–∏–≥—Ä–∞—Ü–∏–∏: `DataAccessLayer/Migrations` (–≤–∫–ª—é—á–∞—è `InitialCreate`).
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è/–ø–æ—Å–µ–≤: `DataAccessLayer/DbInitializer.cs` ‚Äî —Å–æ–∑–¥–∞—ë—Ç —Ä–æ–ª–∏ `admin`, `user` –∏ –¥–≤–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ `admin@example.com`/`user@example.com`.

## –¢—Ä–µ—É–±–≤–∞–Ω–∏—è –∏ —Å–æ–≤–µ—Ç—ã ‚ö†Ô∏è

- Postgres 18+ —Ç—Ä–µ–±—É–µ—Ç –∞–∫–∫—É—Ä–∞—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å volume; –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî —É–¥–∞–ª—è–π—Ç–µ volume –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.
- –ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç runtime-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π: —Ñ–∞–±—Ä–∏–∫–∞ –¥–∏–∑–∞–π–Ω–∞ –∏—â–µ—Ç `appsettings.json` –∏/–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è.
- –í –º–∏–≥—Ä–∞—Ü–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã SQL-–ª–∏—Ç–µ—Ä–∞–ª—ã (`CURRENT_TIMESTAMP`) –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –¥–∞—Ç, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ DateTime/—á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏.

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

- –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ API:

```bash
docker compose -f StoneFlowersApi/docker-compose.yml logs -f webapi
```

- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:

```bash
docker compose -f StoneFlowersApi/docker-compose.yml ps
```

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ ‚Äî –º–æ–≥—É –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª—ã –ø—Ä–æ CI (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –ø—Ä–∏ –¥–µ–ø–ª–æ–µ) –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å `Makefile`/—Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞.